# Dockerfile

# --- СТУПЕНЬ 1: Сборка React-приложения ---

# Используем официальный образ Node.js в качестве базового.
# Мы используем LTS (Long-Term Support) версию 'iron'
FROM node:20-alpine as builder

# Устанавливаем рабочую директорию внутри контейнера.
WORKDIR /app

# Копируем package.json и package-lock.json (или yarn.lock) для установки зависимостей.
COPY package*.json ./

# Устанавливаем зависимости проекта.
RUN npm install

# Копируем остальные файлы проекта в рабочую директорию.
COPY . .

# Собираем приложение для продакшена.
# Vite по умолчанию соберет все в папку 'dist'.
RUN npm run build


# --- СТУПЕНЬ 2: Настройка Nginx и запуск ---

# Используем официальный легковесный образ Nginx.
FROM nginx:1.25-alpine

# Копируем собранные статические файлы из ступени 'builder'.
# Vite собирает приложение в папку /app/dist.
# Мы копируем ее содержимое в директорию, откуда Nginx раздает статику.
COPY --from=builder /app/dist /usr/share/nginx/html

# Копируем наш кастомный конфигурационный файл Nginx.
COPY nginx/nginx.conf /etc/nginx/nginx.conf

# Открываем порт 10000, который будет слушать наш Nginx.
# Render автоматически определит этот порт.
EXPOSE 10000

# Команда для запуска Nginx в режиме "не-демона", чтобы контейнер не завершался сразу после запуска.
CMD ["nginx", "-g", "daemon off;"]